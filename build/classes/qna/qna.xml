<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="qna">
  <select id="count" resultType="int">
  select count(*) from p_qna
 </select>
 
 <select id="list" resultType="qna.dto.QnaDTO">
   select * 
	from (
    select A.*, rownum as rn
    from (
        select num,writer,title,
        content, review_count, picture,
        iname, passwd, reg_date,category,
         filename,filesize,down,re_level
         ,(select count(*) from qna_comment 
           where qna_num=num) comment_count, show
    				from p_qna
    				order by ref desc, re_step asc) A
	) where rn between #{start} and #{end}
 </select>
  
  <select id="categorycount" resultType="int">
  select count(*) from p_qna
  where category = #{category}
 </select>
  
  <select id="categorylist" resultType="qna.dto.QnaDTO">
   select * 
	from (
    select A.*, rownum as rn
    from (
        select num,writer,title,
        content, review_count, picture,
        iname, passwd, reg_date,category,
         filename,filesize,down,re_level
         ,(select count(*) from qna_comment 
           where qna_num=num) comment_count, show
    	   from p_qna
    	   where category = #{category}
    				order by ref desc, re_step asc) A
	) where rn between #{start} and #{end}
 </select>
  
  <insert id="insert">
    insert into p_qna(num,category,writer,title,content,filename,filesize,passwd,ref,re_step,re_level) 
values
( (select nvl(max(num)+1,1) from p_qna),#{category},
 #{writer},#{title},
 #{content},#{filename},#{filesize},#{passwd},
 (select nvl(max(num)+1,1) from p_qna) ,1,0)
  </insert>
  
   <!-- 조회수 증가 처리 -->
 <update id="plusReadCount">
  update p_qna set review_count=review_count+1 
  where num=#{num}
 </update>
  
  <select id="view" resultType="qna.dto.QnaDTO">
  select * from p_qna
  where num=#{num}
 </select>
  
  <select id="getFileName" resultType="String">
  select filename
	from p_qna
	where num=#{num}
 </select>
  
   <!-- 비밀번호 체크 -->
 <select id="pass_check" resultType="String">
  select passwd from p_qna
  where num=#{num} and passwd=#{passwd}
 </select>
  
 </mapper>